# 02. API Implementation (FastAPI ì‚¬ìš©)

01ì—ì„œëŠ” APIë¥¼ êµ¬ì„±í•˜ëŠ” í•µì‹¬ ìš”ì†Œ ì¤‘ ë‘ ê°€ì§€ì¸ SQLite ë°ì´í„°ë² ì´ìŠ¤ì™€, íŒŒì´ì¬ì´ ë°ì´í„°ì™€ ìƒí˜¸ ì‘ìš©í•  ìˆ˜ ìˆë„ë¡
í•˜ëŠ” SQLAlchemy í´ë˜ìŠ¤ë¥¼ êµ¬í˜„í–ˆë‹¤. 

02ì—ì„œëŠ” ì´ ê¸°ë°˜(01ì—ì„œ ë§Œë“  ë°ì´í„°ë² ì´ìŠ¤) ìœ„ì— ë‚¨ì€ êµ¬ì„± ìš”ì†Œë¥¼ êµ¬í˜„í•˜ì—¬ APIë¥¼ ì™„ì„±í•œë‹¤. 
ë¨¼ì ¸, ìš”ì²­ ë° ì‘ë‹µ ë©”ì‹œì§€ì˜ êµ¬ì¡°ë¥¼ ì •ì˜í•˜ëŠ” Pydantic ìŠ¤í‚¤ë§ˆë¥¼ ì‘ì„±í•˜ê³ , ê·¸ ë‹¤ìŒì— ì „ì²´ API ë¡œì§ì„ í†µí•©í•´ ì œì–´í•˜ëŠ”
FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬í˜„í•  ê²ƒì´ë‹¤.

---

02. API Implementation ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì†Œí”„íŠ¸ì›¨ì–´


| ì†Œí”„íŠ¸ì›¨ì–´ ì´ë¦„ | ë²„ì „ | ëª©ì  |
|---|---|---|
| FastAPI | 0 | APIë¥¼ êµ¬ì¶•í•˜ê¸° ìœ„í•œ ì›¹ í”„ë ˆì„ì›Œí¬ |
| FastAPI CLI | 0 | FastAPI ëª…ë ¹ì¤„ ì¸í„°í˜ì´ìŠ¤ |
| HTTPX | 0 | íŒŒì´ì¬ìš© HTTP í´ë¼ì´ì–¸íŠ¸ |
| Pydantic | 2 | ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬ ë° êµ¬ì¡° ì •ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ |
| Uvicorn | 0 | FastAPI ì‹¤í–‰ìš© ASGI ì›¹ ì„œë²„ |

FastAPI: API êµ¬ì¶•ì„ ëª©ì ìœ¼ë¡œ ì„¤ê³„ë™¨ ì›¹ í”„ë ˆì„ì›Œí¬ë‹¤. 
> ì›¹ í”„ë ˆì„ì›Œí¬: ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œ ê³¼ì •ì—ì„œ ë°˜ë³µì ìœ¼ë¡œ ìˆ˜í–‰ë˜ëŠ” ì‘ì—…ì„ ê°„í¸í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ ë•ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ ì§‘í•©ì´ë‹¤.

FastAPIì˜ ì£¼ìš” ê¸°ëŠ¥ì€ ì•„ë˜ì™€ ê°™ë‹¤.
- HTTP ìš”ì²­ê³¼ ì‘ë‹µ ì²˜ë¦¬ ë“± ë„¤íŠ¸ì›Œí¬ ê´€ë ¨ ì‘ì—…ã…‡ë¥´ ë‹¨ ëª‡ ì¤„ì˜ ì½”ë“œë¡œ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.
- API ëª…ì„¸ë¥¼ ì„¤ëª…í•˜ëŠ” OAS íŒŒì¼ì„ ìë™ìœ¼ë¡œ ìƒì„±í•˜ë©°, ì´ë¥¼ í†µí•´ ì™¸ë¶€ ì‹œìŠ¤í…œê³¼ ì‰½ê²Œ í†µí•©í•  ìˆ˜ ìˆë‹¤.
- ì‚¬ìš©ìê°€ ì§ì ‘ ìš”ì²­ì„ í…ŒìŠ¤íŠ¸í•´ ë³¼ ìˆ˜ ìˆëŠ” ëŒ€í™”í˜• API ë¬¸ì„œë¥¼ ìë™ìœ¼ë¡œ ì œê³µí•œë‹¤.
- ë²„ì „ ê´€ë¦¬, ì¸ì¦ ë° ë³´ì•ˆ, ìš”ì²­ ìœ íš¨ì„± ê²€ì¦ ë“± ë‹¤ì–‘í•œ ê³ ê¸‰ ê¸°ëŠ¥ì„ ì§€ì›í•œë‹¤.


HTTPX: FastAPI ê¸°ë°˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë¹„ë™ê¸° ì²˜ë¦¬ ì„±ëŠ¥ì„ ê·¹ëŒ€í™”í•˜ê³ , í…ŒìŠ¤íŠ¸ ìë™í™” í™˜ê²½ì—ì„œë„ í•„ìˆ˜ì ìœ¼ë¡œ í™œìš©ë˜ëŠ” í•µì‹¬ ë„êµ¬ ì¤‘ í•˜ë‚˜ì´ë‹¤.


Pydantic: API ì—”ë“œí¬ì¸íŠ¸ë¥¼ í†µí•´ ì˜¤ê°€ëŠ” ë°ì´í„° í˜•ì‹ê³¼ ìœ íš¨ì„±ì„ ê²€ì‚¬í•˜ëŠ”ë° ë„ì›€ì„ ì¤€ë‹¤.


Uvicorn: FastAPIì™€ ê°™ì€ ë¹„ë™ê¸° ì›¹ í”„ë ˆì„ì›Œí¬ë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•œ í‘œì¤€ ì„œë²„ë¡œ ë„ë¦¬ ì‚¬ìš©ëœë‹¤.
ASGI ëª…ì„¸ì— ë”°ë¼ ì„¤ê³„ë˜ì–´ FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê³ ì„±ëŠ¥ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•œë‹¤.


ì•„ë˜ëŠ” ì´ë²ˆ í”„ë¡œì íŠ¸ì—ì„œì˜ ê° íŒŒì¼ë“¤ì˜ ëª©ì ì´ë‹¤.

| íŒŒì¼ëª… | ëª©ì  |
| --- | --- |
| crud.py | ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ë¥¼ ìœ„í•œ ë„ìš°ë¯¸ í•¨ìˆ˜ |
| database.py | SQL ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ SQLAlchemy ì„¤ì • |
| models.py | ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ê³¼ ê´€ë ¨ëœ SQLAlchemy í´ë˜ìŠ¤ ì •ì˜ |
| requirements.txt | pip íŒ¨í‚¤ì§€ ê´€ë¦¬ìë¡œ íŠ¹ì • ë²„ì „ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ì— ì´ìš© |
| test_crud.py | SQLAlchemy íŒŒì¼ì„ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•œ íŒŒì´ì¬ íŒŒì¼ |
| main.py | API ë¼ìš°íŠ¸ë¥¼ ì •ì˜í•˜ê³  ì „ì²´ APIì˜ ë™ì‘ì„ ì œì–´í•˜ëŠ” FastAPI íŒŒì¼ |
| schemas.py | APIë¡œ ì „ë‹¬ë˜ëŠ” ìš”ì²­ ë° ì‘ë‹µ ë°ì´í„°ë¥¼ ê²€ì¦í•˜ëŠ” Pydantic í´ë˜ìŠ¤ë¥¼ ì •ì˜ |
| test_main.py | FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ì„ í…ŒìŠ¤íŠ¸í•˜ëŠ” pytest ì½”ë“œ íŒŒì¼ |



---

## ì‹¤í–‰ íë¦„

ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•´ í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜

`python -m pip install -r requirements.txt`


í„°ë¯¸ë„ì— ì•„ë˜ì˜ ëª…ë ¹ì–´ ì…ë ¥

`pytest test_main.py`


```
(venv-api-dev) PS C:\Users\{your_name}\API_Devlopment\02_api_implementation\src> pytest .\test_main.py
=============================================================== test session starts ================================================================
platform win32 -- Python 3.12.3, pytest-9.0.2, pluggy-1.6.0
rootdir: C:\Users\HeonSu\personal\python\HandsON\API_Devlopment\02_api_implementation\src
plugins: anyio-4.12.1
collected 11 items                                                                                                                                  

test_main.py ...........                                                                                                                      [100%]

================================================================ 11 passed in 1.79s ================================================================ 
(venv-api-dev) PS C:\Users\{your_name}\API_Devlopment\02_api_implementation\src> 
```


ìœ„ì™€ ê°™ì€ ê²°ê³¼ê°€ ë‚˜ì˜¨ë‹¤ë©´ í…ŒìŠ¤íŠ¸ í†µê³¼


---

# API í…ŒìŠ¤íŠ¸

`fastapi run main.py --port {ì‚¬ìš©í•  í¬íŠ¸ ë²ˆí˜¸}`

ìœ„ì˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ë©´ ë‚´ë¶€ì ìœ¼ë¡œ uvicornì„ ì‹¤í–‰í•´ ì„œë²„ë¥¼ ìƒì„±í•œë‹¤.
- FastAPI: **ìš”ì²­ì„ ì–´ë–»ê²Œ ì²˜ë¦¬í• ì§€** ì •ì˜í•˜ëŠ” í”„ë ˆì„ì›Œí¬
- Uvicorn: **ë„¤íŠ¸ì›Œí¬ í¬íŠ¸ ì—´ê³  HTTP ìš”ì²­ì„ ë°›ëŠ”** ì„œë²„

ì„±ê³µì‹œ í„°ë¯¸ë„ì€ ì•„ë˜ì™€ ê°™ì€ í˜•ì‹ì´ ë‚˜ì˜¨ë‹¤.

```
(venv-api-dev) PS C:\{ê²½ë¡œ}\python\HandsON\API_Devlopment\02_api_implementation\src> fastapi run main.py --port 8080 

   FastAPI   Starting production server ğŸš€
 
             Searching for package file structure from directories with __init__.py files
             Importing from C:\{ê²½ë¡œ}\python\HandsON\API_Devlopment\02_api_implementation\src
 
    module   ğŸ main.py
 
      code   Importing the FastAPI app object from the module with the following code:
 
             from main import app
 
       app   Using import string: main:app
 
    server   Server started at http://0.0.0.0:8080
    server   Documentation at http://0.0.0.0:8080/docs
 
             Logs:
 
      INFO   Started server process [2304]
      INFO   Waiting for application startup.
      INFO   Application startup complete.
      INFO   Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
```

ìœ„ì˜ ì¶œë ¥ ê²°ê³¼ê°€ ë‚˜ì™”ë‹¤ë©´ ë¸Œë¼ìš°ì €ì—

`localhost:{ì‚¬ìš©í•œ í¬íŠ¸ ë²ˆí˜¸}`

ì„ ì…ë ¥í•œë‹¤. ì„±ê³µ ì‹œ

`{"message":"API ìƒíƒœ í™•ì¸ ì„±ê³µ"}`

ìœ„ì™€ ê°™ì€ ë©”ì‹œì§€ê°€ ë‚˜ì˜¨ë‹¤.

ë‹¤ìŒ ë‹¨ê³„ë¡œ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ëŠ” API ì—”ë“œí¬ì¸íŠ¸ë¥¼ í…ŒìŠ¤íŠ¸í•´ë³´ì. ë¸Œë¼ìš°ì €ì˜ ê¸°ë³¸ URL ë’¤ì— ì›í•˜ëŠ” ì¿¼ë¦¬ë¥¼ ì…ë ¥í•œë‹¤.

`localhost:{ì‚¬ìš©í•œ í¬íŠ¸ ë²ˆí˜¸}/v0/performances/?limit=5`

ê²°ê³¼ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

```
[
  {
    "performance_id": 2501,
    "player_id": 1001,
    "week_number": "202301",
    "fantasy_points": 20,
    "last_changed_date": "2024-03-01"
  },
  {
    "performance_id": 2502,
    "player_id": 1002,
    "week_number": "202301",
    "fantasy_points": 22,
    "last_changed_date": "2024-03-01"
  },
  {
    "performance_id": 2503,
    "player_id": 1003,
    "week_number": "202301",
    "fantasy_points": 13,
    "last_changed_date": "2024-03-01"
  },
  {
    "performance_id": 2504,
    "player_id": 1004,
    "week_number": "202301",
    "fantasy_points": 15,
    "last_changed_date": "2024-03-01"
  },
  {
    "performance_id": 2505,
    "player_id": 1005,
    "week_number": "202301",
    "fantasy_points": 3,
    "last_changed_date": "2024-03-01"
  }
]
```

---

ìš”ì•½

= FastAPI, SQLAlchemy, Pydantic, Uvicornì„ ë¹„ë¡¯í•œ ì—¬ëŸ¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í–ˆë‹¤.

- API ì‚¬ìš©ìê°€ ì›í•˜ëŠ” ë°ì´í„°ë¥¼ êµ¬ì¡°í™”í•´ ì „ë‹¬í•  ìˆ˜ ìˆë„ë¡ Pydantic ìŠ¤í‚¤ë§ˆë¥¼ ì •ì˜í–ˆë‹¤.

- í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì„ ì²˜ë¦¬í•˜ê³  ì‘ë‹µì„ ë°˜í™˜í•˜ëŠ” FastAPI í”„ë¡œê·¸ë¨ì„ ì‘ì„±í•´ ì „ì²´ êµ¬ì„± ìš”ì†Œë¥¼ í•˜ë‚˜ì˜ ì‹œìŠ¤í…œìœ¼ë¡œ í†µí•©í–ˆë‹¤.

- pytestë¥¼ ì‚¬ìš©í•´ API ê¸°ëŠ¥ì„ ê²€ì¦í•˜ê³ , ì‹¤ì œ ì›¹ ì„œë²„ì—ì„œ ì‹¤í–‰í•´ ì„±ê³µì ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í–ˆë‹¤.